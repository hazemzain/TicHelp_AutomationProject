# Maven CI/CD Pipeline for Java
# Builds the project, installs JDK, and runs tests.

trigger:
  - master

pool:
  name: 'Default'
  demands:
    - agent.name -equals HAZEMZAIN  # Ensure this matches the actual agent name

steps:
  # Install JDK 21
  - task: JavaToolInstaller@0
    inputs:  # ✅ Added missing 'inputs' key
      versionSpec: '21'
      jdkArchitecture: 'x64'  # ✅ Corrected from 'jdkArchitectureOption'
      jdkSourceOption: 'PreInstalled'

  # Run Maven tests
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'Installed'  # ✅ Change from JDKVersion to Installed
      publishJUnitResults: true
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      goals: 'test'
